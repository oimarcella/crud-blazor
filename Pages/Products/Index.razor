@page "/products";
@inject AppDbContext _context;
@using Microsoft.EntityFrameworkCore;
@using System.Globalization;

<div class="d-flex align-items-center head">
    <h1>Produtos cadastrados</h1>
    <a href="products/create" class="btn btn-1">Novo produto</a>
</div>

<table>
    <tr>
        <td>ID</td>
        <td>Produto</td>
        <td>Preço</td>
        <td>Categoria</td>
        <td class="text-center">Editar</td>
        <td class="text-center">Deletar</td>
    </tr>
    @foreach (var produto in _products)
    {
        <tr asp-id=@produto.Id>
            <td>@produto.Id</td>
            <td>@produto.Title</td>
            <td>@produto.Price.ToString("C", new CultureInfo("pt-BR"))</td>
            <td>@produto.ProductCategory.Title</td>
            <td class="text-center">
                <a href="/products/edit/@produto.Id"><i class="fa-solid fa-pen"></i></a>
            </td>
            <td class="text-center">
                <a class="ml-3 btn btn-delete" href="/products/delete/@produto.Id"><i class="fa-solid fa-trash"></i></a>
            </td>
        </tr>
    }
</table>

@code {
    Product _model = new();
    List<Product> _products = new();
    string? _errorMessage = null;

    protected override async Task OnInitializedAsync()
    {
        _products = await _context.Products
        .Include(x => x.ProductCategory)
        .AsNoTracking()
        .ToListAsync();
    }
}